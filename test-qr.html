<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            width: 100%;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #qrCanvas {
            border: 1px solid #ccc;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QR Code Generator Test</h1>
        <input type="text" id="textInput" placeholder="Enter text to encode" value="bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh">
        <button onclick="generateQR()">Generate QR Code</button>
        <canvas id="qrCanvas"></canvas>
    </div>

    <script type="module">
        // QR Code generator implementation (simplified version for testing)
        const ALPHANUMERIC_TABLE = {
            '0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9,
            'A': 10, 'B': 11, 'C': 12, 'D': 13, 'E': 14, 'F': 15, 'G': 16, 'H': 17, 'I': 18,
            'J': 19, 'K': 20, 'L': 21, 'M': 22, 'N': 23, 'O': 24, 'P': 25, 'Q': 26, 'R': 27,
            'S': 28, 'T': 29, 'U': 30, 'V': 31, 'W': 32, 'X': 33, 'Y': 34, 'Z': 35,
            ' ': 36, '$': 37, '%': 38, '*': 39, '+': 40, '-': 41, '.': 42, '/': 43, ':': 44,
        };

        function generateSimpleQRMatrix(text) {
            // This is a simplified version that creates a basic pattern
            // For production, use the full implementation from qr-generator.ts

            const size = 33; // Version 3 QR code
            const matrix = Array(size).fill(null).map(() => Array(size).fill(false));

            // Add finder patterns
            const addFinderPattern = (row, col) => {
                for (let r = 0; r <= 6; r++) {
                    for (let c = 0; c <= 6; c++) {
                        if (row + r < size && col + c < size) {
                            matrix[row + r][col + c] =
                                (r === 0 || r === 6 || c === 0 || c === 6 ||
                                (r >= 2 && r <= 4 && c >= 2 && c <= 4));
                        }
                    }
                }
            };

            addFinderPattern(0, 0);
            addFinderPattern(0, size - 7);
            addFinderPattern(size - 7, 0);

            // Add timing patterns
            for (let i = 8; i < size - 8; i++) {
                matrix[6][i] = matrix[i][6] = i % 2 === 0;
            }

            // Add alignment pattern for version 3
            const alignPos = 18;
            for (let r = -2; r <= 2; r++) {
                for (let c = -2; c <= 2; c++) {
                    if (alignPos + r >= 0 && alignPos + r < size &&
                        size - 7 + c >= 0 && size - 7 + c < size) {
                        matrix[alignPos + r][size - 7 + c] =
                            Math.abs(r) === 2 || Math.abs(c) === 2 || (r === 0 && c === 0);
                    }
                }
            }

            // Add format info area
            for (let i = 0; i < 9; i++) {
                if (i !== 6) {
                    matrix[8][i] = true;
                    matrix[size - i - 1][8] = true;
                }
            }
            for (let i = 0; i < 8; i++) {
                matrix[8][size - 8 + i] = true;
                matrix[7 - i][8] = true;
            }

            // Add dark module
            matrix[4 * 3 + 9][8] = true;

            // Simulate data encoding (creates a pattern based on text)
            let hash = 0;
            for (let i = 0; i < text.length; i++) {
                hash = ((hash << 5) - hash) + text.charCodeAt(i);
                hash = hash & hash;
            }

            // Fill data area with pseudo-random pattern based on text
            for (let row = 0; row < size; row++) {
                for (let col = 0; col < size; col++) {
                    // Skip function patterns
                    if (row < 9 && col < 9) continue; // Top-left finder
                    if (row < 9 && col >= size - 8) continue; // Top-right finder
                    if (row >= size - 8 && col < 9) continue; // Bottom-left finder
                    if (row === 6 || col === 6) continue; // Timing patterns

                    // Generate pseudo-random bit based on position and text hash
                    const bit = ((hash + row * 31 + col * 37) % 2) === 0;
                    matrix[row][col] = bit;
                }
            }

            return matrix;
        }

        window.generateQR = function() {
            const text = document.getElementById('textInput').value;
            const canvas = document.getElementById('qrCanvas');
            const ctx = canvas.getContext('2d');

            const matrix = generateSimpleQRMatrix(text);
            const size = matrix.length;
            const cellSize = 10;
            const margin = 2;
            const canvasSize = (size + margin * 2) * cellSize;

            canvas.width = canvasSize;
            canvas.height = canvasSize;

            // Clear canvas
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, canvasSize, canvasSize);

            // Draw QR code
            ctx.fillStyle = '#000000';
            for (let row = 0; row < size; row++) {
                for (let col = 0; col < size; col++) {
                    if (matrix[row][col]) {
                        ctx.fillRect(
                            (col + margin) * cellSize,
                            (row + margin) * cellSize,
                            cellSize,
                            cellSize
                        );
                    }
                }
            }
        };

        // Generate initial QR code
        window.generateQR();
    </script>
</body>
</html>