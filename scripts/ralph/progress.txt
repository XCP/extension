# Ralph Progress Log - E2E Test Audit
Started: Wed, Jan 21, 2026 12:46 PM

## Codebase Patterns
- E2E test files are in e2e/pages/**/*.spec.ts (mirrors app route structure)
- E2E input tests are in e2e/inputs/*.spec.ts
- E2E flow/integration tests are in e2e/tests/*.spec.ts
- Use walletTest fixture from e2e/fixtures.ts for wallet-authenticated tests
- selectors.ts contains reusable selectors - prefer these over inline locators
- compose-test-helpers.ts has helpers for compose flow testing (enableValidationBypass, enableDryRun, waitForReview)
- test-data.ts has TEST_ADDRESSES and TEST_AMOUNTS constants
- Provider tests require proper context (requestId, origin) - direct navigation shows error/redirect
- Run single test file: npx playwright test path/to/test.spec.ts
- Run single test: npx playwright test -g "test name"
- **NEVER use npm test or npm test:e2e** - these are for CI only

## Key Audit Findings
- 97 tests with `|| true` pattern - these ALWAYS pass and are meaningless
- 337 total permissive `expect(a || b || c).toBe(true)` patterns
- Provider tests (approve-connection, approve-transaction, approve-psbt) only check page loads
- Compose tests use validation bypass which is good but may miss real API issues
- Many broad regex patterns: /error|invalid|wrong|failed/ match too many things

---

## 2026-01-21 - E2E-001: Document e2e test audit findings
- What was implemented:
  - Created comprehensive audit document: tasks/e2e-test-audit.md
  - Identified 97 always-pass tests (|| true patterns)
  - Identified 337 permissive expect patterns
  - Categorized tests by risk priority (P25 Security/Money, P20 Core, P15 Standard)
  - Listed top offender files for both patterns
  - Analyzed provider tests (page load only - inadequate)
  - Analyzed compose tests (good structure, weak assertions)
  - Provided recommendations for each phase of cleanup
- Files changed:
  - tasks/e2e-test-audit.md (created)
  - scripts/ralph/prd.json (updated)
  - scripts/ralph/progress.txt (updated)
- **Learnings for future iterations:**
  - Top offender for always-pass: consolidate.spec.ts (5), form-edge-cases.spec.ts (4)
  - Security-critical files with issues: show-private-key.spec.ts (3+7 patterns)
  - Provider tests are Priority 25 but currently worthless (only check page loads)
  - selectors.ts is comprehensive (500+ lines) but many tests use inline locators
  - Start cleanup with P25 Security files first

---

