{
  "project": "XCP Wallet E2E Test Audit",
  "branchName": "e2e-test-audit",
  "description": "E2E Test Quality Audit - Remove meaningless tests, improve test specificity, and enhance critical path coverage",
  "context": {
    "findings": {
      "alwaysPassTests": 97,
      "permissivePatterns": 337,
      "broadRegexPatterns": "Many tests use /text1|text2|text3/ patterns that match too broadly",
      "providerTestsStatus": "Very thin - only check page loads, not actual approval flows",
      "composeTestsStatus": "Use validation bypass/dry run which is good for isolation but may miss real API integration issues"
    },
    "testPrinciples": {
      "riskBased": "Priority = Impact (1-5) × Probability (1-5). Tests with Score >= 15 are KEEP, 10-14 REVIEW, <10 REMOVE",
      "noAlwaysPass": "Tests with || true are meaningless and should be removed or made meaningful",
      "specificAssertions": "Tests should assert specific expected values, not 'any of these things exist'"
    }
  },
  "userStories": [
    {
      "id": "E2E-001",
      "title": "Document e2e test audit findings",
      "description": "Create a comprehensive audit document of e2e test quality issues",
      "acceptanceCriteria": [
        "Create tasks/e2e-test-audit.md with categorized findings",
        "List all files with || true patterns (always-pass tests)",
        "List all files with broad || permissive patterns",
        "Categorize tests by risk priority (Money/Security=25, Core flows=20, Standard=15)",
        "Identify wasteful tests (Score <10) vs valuable tests (Score >=15)"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Created comprehensive tasks/e2e-test-audit.md: 97 always-pass tests, 337 permissive patterns, provider tests only check page loads, categorized by risk priority P25/P20/P15"
    },
    {
      "id": "E2E-002",
      "title": "Remove always-pass tests from inputs directory",
      "description": "Fix or remove tests in e2e/inputs/ that use || true patterns",
      "acceptanceCriteria": [
        "Remove || true from all tests in e2e/inputs/*.spec.ts",
        "Either make the test meaningful (specific assertion) or delete the test",
        "If test is truly optional UI check, add skip() or convert to comment explaining why",
        "All modified tests must pass: npx playwright test e2e/inputs/",
        "Document changes in progress.txt"
      ],
      "priority": 2,
      "passes": false,
      "notes": "Inputs are lower priority - focus on making assertions meaningful or removing"
    },
    {
      "id": "E2E-003",
      "title": "Remove always-pass tests from pages directory",
      "description": "Fix or remove tests in e2e/pages/ that use || true patterns",
      "acceptanceCriteria": [
        "Remove || true from all tests in e2e/pages/**/*.spec.ts",
        "Either make the test meaningful (specific assertion) or delete the test",
        "High-value tests (compose, provider, auth) should have specific assertions",
        "All modified tests must pass their specific file",
        "Document changes in progress.txt"
      ],
      "priority": 3,
      "passes": false,
      "notes": "Pages tests are higher priority than inputs"
    },
    {
      "id": "E2E-004",
      "title": "Improve provider approval tests",
      "description": "Provider tests currently only check page loads. Make them test actual approval flow.",
      "acceptanceCriteria": [
        "approve-connection.spec.ts: Test shows origin, approve/reject buttons work",
        "approve-transaction.spec.ts: Test shows tx details, approve/reject buttons work",
        "approve-psbt.spec.ts: Test shows PSBT details, approve/reject buttons work",
        "Tests use proper context setup (not just direct navigation)",
        "All provider tests pass: npx playwright test e2e/pages/provider/"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Provider approval is a critical security path - Priority 25"
    },
    {
      "id": "E2E-005",
      "title": "Improve compose send test specificity",
      "description": "Compose send tests should verify specific values on review page, not just 'review exists'",
      "acceptanceCriteria": [
        "Review page test verifies exact destination address shown matches input",
        "Review page test verifies exact amount shown matches input",
        "Review page test verifies asset name shown",
        "Remove broad regex patterns like /review|confirm|sign/i",
        "Tests pass: npx playwright test e2e/pages/compose/send/"
      ],
      "priority": 5,
      "passes": false,
      "notes": "Compose send is a critical money path - Priority 25"
    },
    {
      "id": "E2E-006",
      "title": "Add compose flow integration test",
      "description": "Create a full integration test that exercises form → review → back → edit cycle with specific assertions",
      "acceptanceCriteria": [
        "Test fills form with known test data",
        "Test submits and verifies review page shows EXACT values entered",
        "Test clicks back and verifies form preserves EXACT values",
        "Test edits values and resubmits",
        "Test verifies review page shows EXACT new values",
        "Test lives in e2e/tests/compose-integration.spec.ts"
      ],
      "priority": 6,
      "passes": false,
      "notes": "This tests the critical form→review→back cycle that surfaces many bugs in manual testing"
    },
    {
      "id": "E2E-007",
      "title": "Standardize selector usage",
      "description": "Audit and improve consistency of selector usage across e2e tests",
      "acceptanceCriteria": [
        "Document which tests use selectors.ts vs inline locators",
        "Identify selectors that should be added to selectors.ts",
        "Update 5+ tests to use selectors.ts instead of inline locators",
        "Add selectors for common elements not yet in selectors.ts",
        "Document selector naming conventions in e2e/README.md or selectors.ts comments"
      ],
      "priority": 7,
      "passes": false,
      "notes": "Selector consistency improves maintainability"
    },
    {
      "id": "E2E-008",
      "title": "Remove or justify remaining permissive patterns",
      "description": "Final pass to remove remaining || patterns that aren't justified",
      "acceptanceCriteria": [
        "Grep for remaining 'expect.*||' patterns",
        "For each: either make specific OR add comment justifying why permissive is OK",
        "Valid justifications: loading state race condition, API may return different formats",
        "Invalid: 'we don't know what to expect' - that means test is meaningless",
        "Document final count in progress.txt"
      ],
      "priority": 8,
      "passes": false,
      "notes": "Goal: reduce from 337 to <50 justified permissive patterns"
    }
  ]
}
